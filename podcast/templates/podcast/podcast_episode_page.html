{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags wagtailuserbar %}

{% block title %}Into the Moss | {{ page.title }}{% endblock %}

{% block content %}
<div class="episode-player-container">
  <div id="episode-player" style="{% if page.cover_image %}background-image:url({% image page.cover_image original format-webp as webp_img %}{{ webp_img.url }}){% else %}background-image:url({% static 'images/default-cover.webp' %}){% endif %}">
    <div class="player-info-container">
      <div id="player-info">
        <h1>{{ page.episode_number }}: {{ page.title }}</h1>
        <audio controls src="{{ page.audio_file.url }}"></audio>
        <p>{{ page.description|richtext }}</p>
        <p>First broadcast on <a href="https://resonancefm.com" target="_blank">Resonance 104.4 FM</a>, {{ page.publication_date|date:"d M Y" }}.</p>
        <p><a href="/">← All episodes</a> {% if page.transcript %}&nbsp; <a href="#episode-transcript" id="transcript-scroll">Transcript ↓</a>{% endif %}</p>
      </div>
    </div>
  </div>
</div>

{% if page.transcript %}
<div class="episode-text" id="episode-transcript">
  {{ page.transcript|richtext }}
</div>
{% endif %}

{% block wagtailuserbar %}
    {% wagtailuserbar %}
{% endblock wagtailuserbar %}

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Back to top button functionality
    const backToTopButton = document.getElementById('back-to-top');
    const episodePlayer = document.getElementById('episode-player');
    
    // Show/hide back to top button based on scroll position
    function toggleBackToTopButton() {
      if (window.scrollY > 300) {
        backToTopButton.classList.add('visible');
      } else {
        backToTopButton.classList.remove('visible');
      }
    }
    
    // Listen for scroll events
    window.addEventListener('scroll', toggleBackToTopButton);
    
    // Back to top button click handler
    backToTopButton.addEventListener('click', function() {
      window.scrollTo({ 
        top: 0,
        behavior: 'smooth'
      });
    });

    {% if page.transcript %}
    // Transcript scroll functionality
    const transcriptScroll = document.getElementById('transcript-scroll');
    const transcript = document.getElementById('episode-transcript');
    
    transcriptScroll.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Smooth scroll to transcript
      transcript.scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
      });
    });
    {% endif %}
    
    // Initial check for back to top button visibility
    toggleBackToTopButton();
  });
</script>
{% endblock %}

